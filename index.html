import React, { useState } from 'react';
import { User, Users, Shirt, Send, CheckCircle, Loader2 } from 'lucide-react';

export default function App() {
  const [formData, setFormData] = useState({
    name: '',
    friendRef: '',
    size: ''
  });
  
  const [status, setStatus] = useState('idle'); // idle, submitting, success, error

  // Google Form Configuration
  const FORM_ACTION_URL = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSdE_GZZWJ9ZL-L72hGmSVSr5ddp9vNYhILUafjEuef0oZD-bA/formResponse";
  
  // Field Mapping based on your provided HTML
  const FIELD_IDS = {
    name: "entry.345964497",
    friendRef: "entry.472189431",
    size: "entry.61922842"
  };

  const sizes = ["S", "M", "L", "XL", "2L", "3L", "5L"];

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSizeSelect = (selectedSize) => {
    setFormData(prev => ({
      ...prev,
      size: selectedSize
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setStatus('submitting');

    // Create form data payload
    const data = new FormData();
    data.append(FIELD_IDS.name, formData.name);
    data.append(FIELD_IDS.friendRef, formData.friendRef);
    data.append(FIELD_IDS.size, formData.size);

    try {
      // Use no-cors mode to bypass CORS restriction. 
      // Note: We won't get a readable response content, but the submission works.
      await fetch(FORM_ACTION_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: data
      });

      // Assuming success if no network error
      setStatus('success');
      setFormData({ name: '', friendRef: '', size: '' });
      
    } catch (error) {
      console.error("Submission Error:", error);
      setStatus('error');
    }
  };

  if (status === 'success') {
    return (
      <div className="min-h-screen bg-stone-50 flex items-center justify-center p-4 font-sans">
        <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center border-t-8 border-red-600">
          <div className="mx-auto bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mb-6">
            <CheckCircle className="w-10 h-10 text-green-600" />
          </div>
          <h2 className="text-2xl font-bold text-gray-800 mb-2">å ±åæˆåŠŸï¼</h2>
          <p className="text-gray-600 mb-8">æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼Œæˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„å ±åè³‡è¨Šã€‚</p>
          <button 
            onClick={() => setStatus('idle')}
            className="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-6 rounded-full transition-colors w-full"
          >
            å¡«å¯«ä¸‹ä¸€ç­†
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-[#FDFBF7] font-sans pb-12">
      {/* Hero Header */}
      <div className="w-full bg-red-800 shadow-lg relative overflow-hidden">
        <div className="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/chinese-pattern.png')]"></div>
        <div className="max-w-4xl mx-auto">
          {/* Main Header Image */}
          <div className="w-full aspect-[21/9] md:aspect-[3/1] relative bg-gray-200">
            <img 
              src="https://lh7-rt.googleusercontent.com/formsz/AN7BsVCeFHpmHYl29g_1nJFP7ouUSNEmtpPRZXRFCezCkRiGKtdDewCzkMXD3HCSlbsk7Gu31N1H99eDyyFac5QJ62KRKDGZLaaxopN4RzcP91ekw_QCub2rD6RbWKeai7eSKi1_kbgw_2tnBdanuH4o24JXQU3fSGIGRN0aM6FFS9zOpCa12zx6En7pTccKgbKPeqG37REPB7zo0sZI=w1010?key=HsvizbryWxioUGV0m2PKKg" 
              alt="2026ç™½æ²™å±¯åŒ—æ¸¯é€²é¦™" 
              className="w-full h-full object-cover"
            />
          </div>
        </div>
      </div>

      <div className="max-w-3xl mx-auto px-4 -mt-8 relative z-10">
        
        {/* Title Card */}
        <div className="bg-white rounded-xl shadow-md p-6 mb-6 border-t-4 border-yellow-500">
          <h1 className="text-2xl md:text-3xl font-bold text-gray-900 mb-3 tracking-wide">
            2026 ç™½æ²™å±¯åŒ—æ¸¯é€²é¦™å ±å
          </h1>
          <div className="bg-red-50 p-4 rounded-lg border-l-4 border-red-500 text-gray-700">
            <p className="font-medium mb-1 flex items-center">
              ğŸ“… å ±åæ—¥æœŸï¼š3/11 ~ 4/9
            </p>
            <p className="font-medium text-red-700">
              ğŸ’° å ±åè²» $700 (è¡£æœç™¼å®Œå¾Œæ¸›å… $200)
            </p>
          </div>
        </div>

        <form onSubmit={handleSubmit} className="space-y-6">
          
          {/* Section 1: Personal Info */}
          <div className="bg-white rounded-xl shadow-sm p-6">
            <h2 className="text-xl font-bold text-gray-800 mb-6 flex items-center pb-2 border-b border-gray-100">
              <User className="w-5 h-5 mr-2 text-red-600" />
              åŸºæœ¬è³‡æ–™
            </h2>

            <div className="space-y-6">
              {/* Name Input */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  æ‚¨çš„å¤§å (å®Œæ•´å§“å) <span className="text-red-500">*</span>
                </label>
                <div className="relative">
                  <input
                    type="text"
                    name="name"
                    required
                    value={formData.name}
                    onChange={handleInputChange}
                    placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å"
                    className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all bg-gray-50 focus:bg-white"
                  />
                  <User className="w-5 h-5 text-gray-400 absolute right-3 top-3" />
                </div>
              </div>

              {/* Friend Ref Input */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  æ‚¨æ˜¯èª°çš„æœ‹å‹?
                </label>
                <div className="relative">
                  <input
                    type="text"
                    name="friendRef"
                    value={formData.friendRef}
                    onChange={handleInputChange}
                    placeholder="ä»‹ç´¹äººå§“å (é¸å¡«)"
                    className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all bg-gray-50 focus:bg-white"
                  />
                  <Users className="w-5 h-5 text-gray-400 absolute right-3 top-3" />
                </div>
              </div>
            </div>
          </div>

          {/* Section 2: Clothing */}
          <div className="bg-white rounded-xl shadow-sm p-6 overflow-hidden">
            <h2 className="text-xl font-bold text-gray-800 mb-6 flex items-center pb-2 border-b border-gray-100">
              <Shirt className="w-5 h-5 mr-2 text-red-600" />
              é€²é¦™æœå°ºå¯¸
            </h2>

            {/* Size Chart Image */}
            <div className="mb-8 bg-gray-50 rounded-lg p-2 border border-gray-200">
              <p className="text-xs text-center text-gray-500 mb-2">å°ºå¯¸åƒè€ƒè¡¨</p>
              <img 
                src="https://lh7-rt.googleusercontent.com/formsz/AN7BsVCjjys639eEsx4MwbEGL2A4j_Kb8vmXGPmIhneQ-4fQCLJc4w-steu2JPvAnmQpSF-2xinQ9yqcZGd_-cuenpFc1wgK5aStLRLZhJWH3ol9Tfkkht9pu8ccEtIrDyMsXfES786FQj1b7UWZiu3N_efu74YMbG6oRJ1mfqLaHu5A-s8aqnyI8fKeR3MDl3ZBEJOLLCTmyw1nMlNH=w740?key=HsvizbryWxioUGV0m2PKKg" 
                alt="å°ºå¯¸è¡¨" 
                className="w-full h-auto rounded mix-blend-multiply"
              />
            </div>

            {/* Size Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                é¸æ“‡å°ºå¯¸ <span className="text-red-500">*</span>
              </label>
              <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-7 gap-3">
                {sizes.map((size) => (
                  <button
                    key={size}
                    type="button"
                    onClick={() => handleSizeSelect(size)}
                    className={`
                      relative px-2 py-3 rounded-lg border-2 text-sm font-bold transition-all duration-200
                      ${formData.size === size 
                        ? 'border-red-600 bg-red-50 text-red-700 shadow-sm transform scale-105 z-10' 
                        : 'border-gray-200 text-gray-600 hover:border-red-200 hover:bg-gray-50'
                      }
                    `}
                  >
                    {size}
                    {formData.size === size && (
                      <div className="absolute -top-2 -right-2 bg-red-600 text-white rounded-full p-0.5">
                        <CheckCircle className="w-3 h-3" />
                      </div>
                    )}
                  </button>
                ))}
              </div>
              <input 
                type="hidden" 
                name="size" 
                value={formData.size} 
                required 
              />
              {/* Validation Message helper if needed, standard browser validation will catch the hidden input if required but custom UI is better */}
              {!formData.size && status === 'error' && (
                 <p className="text-red-500 text-sm mt-2">è«‹é¸æ“‡ä¸€å€‹å°ºå¯¸</p>
              )}
            </div>
          </div>

          {/* Submit Button */}
          <div className="pt-4">
            <button
              type="submit"
              disabled={status === 'submitting' || !formData.size || !formData.name}
              className={`
                w-full py-4 rounded-xl text-lg font-bold shadow-lg flex items-center justify-center space-x-2 transition-all duration-300
                ${status === 'submitting' || !formData.size || !formData.name
                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                  : 'bg-gradient-to-r from-red-600 to-red-700 text-white hover:shadow-xl hover:-translate-y-1'
                }
              `}
            >
              {status === 'submitting' ? (
                <>
                  <Loader2 className="w-6 h-6 animate-spin" />
                  <span>è³‡æ–™å‚³é€ä¸­...</span>
                </>
              ) : (
                <>
                  <Send className="w-6 h-6" />
                  <span>ç¢ºèªé€å‡ºå ±å</span>
                </>
              )}
            </button>
            <p className="text-center text-xs text-gray-400 mt-4">
              * é»æ“Šé€å‡ºå³ä»£è¡¨ç¢ºèªä¸Šè¿°è³‡æ–™ç„¡èª¤
            </p>
          </div>

        </form>
      </div>
      
      {/* Footer */}
      <footer className="mt-12 py-6 text-center text-gray-400 text-sm">
        <p>Â© 2026 ç™½æ²™å±¯åŒ—æ¸¯é€²é¦™æ´»å‹•</p>
      </footer>
    </div>
  );
}